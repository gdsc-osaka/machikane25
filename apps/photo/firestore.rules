/**
 * T208 [FOUND] Infrastructure: Firestore Security Rules
 *
 * Security rules based on data-model.md and spec.md
 * - Anonymous auth for attendees (FR-001)
 * - Admin role via Custom Claim for staff
 */

rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {


    function isAdmin() {
      return request.auth != null && request.auth.token.role == 'admin';
    }

    function isAuthenticated() {
      return request.auth != null;
    }

    match /options/{optionId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    match /booths/{boothId} {
      allow read, update: if isAuthenticated();
      allow create: if isAdmin();

      match /uploadedPhotos/{photoId} {
        allow read, create: if isAuthenticated();
        allow delete, update: if isAdmin();
      }

      match /generatedPhotos/{photoId} {
        allow read: if true;
        allow create, update, delete: if isAdmin();
      }

    }

  }
}
